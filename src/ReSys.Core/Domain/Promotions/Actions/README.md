# Promotions.Actions Bounded Context

This document describes the `Promotions.Actions` bounded context, outlining its purpose, ubiquitous language, core components, and key behaviors.

---

## üéØ Purpose

This domain defines the concrete effects or benefits that a promotion provides when it is applied to an order. It encapsulates the logic for various types of promotional outcomes, such as applying discounts to the entire order, individual line items, offering free shipping, or implementing "buy X get Y" deals. This modular design allows for flexible and extensible promotion mechanics.

---

## üó£Ô∏è Ubiquitous Language

This section defines the key terms and concepts used within the `Promotions.Actions` bounded context.

-   **Promotion Action**: The concrete effect or benefit provided by a promotion. It determines how an order's totals are adjusted. Represented by the `PromotionAction` entity.
-   **Promotion**: The parent promotion that defines this action. (Referenced from `Promotions.Promotions` Bounded Context).
-   **Promotion Type**: The classification of the action (e.g., `OrderDiscount`, `ItemDiscount`, `FreeShipping`, `BuyXGetY`).
-   **Discount Type**: How a discount is applied, either as a `Percentage` or a `FixedAmount`.
-   **Value**: The amount or percentage of the discount.
-   **Buy Quantity / Get Quantity**: Specific quantities used in "Buy X Get Y" promotions.
-   **Metadata**: Additional, unstructured key-value data, separated into `PublicMetadata` and `PrivateMetadata`.

---

## üèõÔ∏è Core Components (Aggregates, Entities, Value Objects)

This domain is composed of the following core building blocks:

### Aggregates

-   None explicitly defined as Aggregate Roots. `PromotionAction` is an entity that is owned by the `Promotion` aggregate.

### Entities (not part of an Aggregate Root, if any)

-   **`PromotionAction`**: This is the central entity of this bounded context. It is polymorphic, acting as a base for different types of actions, with its internal metadata storing the specific parameters for each action type. It is an `AuditableEntity`.
    -   **Value Objects**: None explicitly defined as separate classes. Properties like `PromotionId`, `Type`, `PublicMetadata`, and `PrivateMetadata` are intrinsic attributes.

### Value Objects (standalone, if any)

-   None.

---

## ‚öôÔ∏è Domain Services (if any)

-   None explicitly defined as separate classes. The `Calculate` method within `PromotionAction` performs the core logic for applying the action, delegating to private methods based on `PromotionType`.

---

## üìú Business Rules / Invariants

This section outlines the critical business rules and invariants enforced within the `Promotions.Actions` bounded context.

-   A `PromotionAction` must always be associated with a valid `PromotionId`.
-   `Buy Quantity` and `Get Quantity` must be greater than zero for `BuyXGetY` promotions.
-   Discount `Value` must be non-negative.
-   The `Calculate` method dynamically dispatches to specific calculation logic based on the `PromotionType`.
-   Adjustments generated by a promotion action are capped by the promotion's `MaximumDiscountAmount`, if defined.
-   `PromotionAction` instances track their creation timestamps (`CreatedAt`), adhering to auditing requirements.

---

## ü§ù Relationships & Dependencies

-   **`PromotionAction` to `Promotion`**: One-to-one relationship. `PromotionAction` is owned by `Promotion` (from `Promotions.Promotions`).
-   **Shared Kernel**: `PromotionAction` inherits from `AuditableEntity<Guid>` and implements `IHasMetadata` (from `SharedKernel.Domain`), leveraging common patterns for auditing and metadata. It uses `ErrorOr` for a functional approach to error handling.
-   **`PromotionCalculationContext`**: Directly uses the `PromotionCalculationContext` (from `Promotions.Calculations`) to perform its calculations.

---

## üöÄ Key Use Cases / Behaviors

-   **Create Promotion Actions**: Instantiate various types of promotion actions (e.g., `CreateOrderDiscount`, `CreateItemDiscount`, `CreateFreeShipping`, `CreateBuyXGetY`).
-   **Calculate Adjustments**: Given a `PromotionCalculationContext`, determine the financial `PromotionAdjustment`s that should be applied to an order based on the defined action.

---

## üìù Considerations / Notes

-   `PromotionAction` acts as a child entity within the `Promotion` aggregate, and its lifecycle is managed by the `Promotion` aggregate.
-   The use of polymorphism (via the `Type` property and `Calculate` method) allows for flexible addition of new promotion action types without altering existing code.
-   The internal `PrivateMetadata` is used to store action-specific parameters (e.g., `discountType`, `value`, `buyVariantId`), allowing for a single `PromotionAction` entity to represent diverse actions.
-   The use of `ErrorOr` for return types promotes a functional approach to error handling.
