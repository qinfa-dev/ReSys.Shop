# Identity.Permissions Bounded Context

This document describes the `Identity.Permissions` bounded context, outlining its purpose, ubiquitous language, core components, and key behaviors.

---

## üéØ Purpose

This domain defines and manages granular access permissions within the system. It provides a structured, standardized way to represent permissions using a `{area}.{resource}.{action}` format, generate human-readable names and descriptions, and categorize them for flexible assignment to users or roles, thereby enforcing security and access control policies.

---

## üó£Ô∏è Ubiquitous Language

This section defines the key terms and concepts used within the `Identity.Permissions` bounded context.

-   **Access Permission**: A specific authorization rule in the system, structured as <c>{area}.{resource}.{action}</c> (e.g., <c>admin.user.create</c>). It grants or denies the ability to perform a certain operation on a resource within an area. Represented by the <see cref="AccessPermission"/> entity.
-   **Area**: The top-level segment of an <see cref="AccessPermission"/>, indicating a functional module, bounded context, or administrative context (e.g., "admin", "catalog", "order").
-   **Resource**: The middle segment of an <see cref="AccessPermission"/>, indicating the specific entity, aggregate, or feature being accessed or manipulated (e.g., "user", "product", "order"). This segment can contain dots for nested resources (e.g., "role.users").
-   **Action**: The last segment of an <see cref="AccessPermission"/>, indicating the specific operation being performed (e.g., "create", "view", "edit", "delete", "manage").
-   **Display Name**: A human-readable, user-friendly name for an <see cref="AccessPermission"/> (e.g., "Create User"), automatically generated by <see cref="AccessPermission.GenerateDisplayName(string, string, string)"/> if not provided.
-   **Description**: A detailed explanation of what an <see cref="AccessPermission"/> allows or restricts, automatically generated by <see cref="AccessPermission.GenerateDescription(string, string, string)"/> if not provided.
-   **Value**: A simplified string representation of an <see cref="AccessPermission"/> (e.g., "admin:user:create"), often used for internal assignment or policy evaluation.
-   **Permission Category**: An enumeration (<see cref="PermissionCategory"/>) indicating whether a permission is primarily intended for assignment to individual users, roles (groups of users), both, or none.

---

## üèõÔ∏è Core Components (Aggregates, Entities, Value Objects)

This domain is composed of the following core building blocks:

### Aggregates

-   None explicitly defined as Aggregate Roots within this domain. <see cref="AccessPermission"/> acts as a standalone entity whose lifecycle is managed by the system, and it is referenced by other aggregates (e.g., <see cref="User"/>, <see cref="Role"/>) for assignment.

### Entities (not part of an Aggregate Root, if any)

-   **`AccessPermission`**: This is the central entity of this bounded context. It represents a single, immutable (in terms of its core <c>Name</c>) access permission. It is an <see cref="AuditableEntity"/>, tracking creation and update details.
    -   **Value Objects**: None explicitly defined as separate classes. Properties like <c>Name</c>, <c>Area</c>, <c>Resource</c>, <c>Action</c>, <c>DisplayName</c>, <c>Description</c>, <c>Value</c>, and <c>Category</c> are intrinsic attributes of the <see cref="AccessPermission"/> entity.

### Value Objects (standalone, if any)

-   **<see cref="PermissionCategory"/>**: An enumeration that categorizes permissions based on their applicability (<c>User</c>, <c>Role</c>, <c>Both</c>, <c>None</c>). This helps in filtering and presenting permissions appropriately in UIs.

---

## ‚öôÔ∏è Domain Services (if any)

-   None explicitly defined as separate classes. Static helper methods within the `AccessPermission` entity (e.g., `GenerateDisplayName`, `GenerateDescription`, `IsValidAccessPermissionName`, `ParseAccessPermissionName`) provide utility functions for formatting, parsing, and validating permission names and their components. These methods encapsulate logic directly related to the `AccessPermission` entity's structure and representation.

---

## üìú Business Rules / Invariants

This section outlines the critical business rules and invariants enforced within the `Identity.Permissions` bounded context.

-   <see cref="AccessPermission"/> names must strictly adhere to the <c>{area}.{resource}.{action}</c> format, consisting of exactly three segments separated by dots. This is validated by <see cref="AccessPermission.IsValidAccessPermissionName(string)"/> and enforced during <see cref="AccessPermission.Create(string, string, string, string?, string?, string?, PermissionCategory)"/>.
-   Each segment (<c>area</c>, <c>resource</c> parts, <c>action</c>) must conform to specific length constraints (<see cref="AccessPermission.Constraints.MinSegmentLength"/> to <see cref="AccessPermission.Constraints.MaxSegmentLength"/>) and a defined regex pattern (<see cref="AccessPermission.Constraints.SegmentAllowedPattern"/>), ensuring consistency and validity.
-   <c>DisplayName</c>, <c>Description</c>, and <c>Value</c> properties have maximum length constraints (e.g., <see cref="AccessPermission.Constraints.MaxDisplayNameLength"/>) to prevent excessive data storage and ensure UI compatibility.
-   The <c>Value</c> property, if provided, must adhere to a specific regex pattern (<see cref="AccessPermission.Constraints.ValueAllowedPattern"/>). Invalid values will result in <see cref="AccessPermission.Errors.ValueInvalidFormat"/>.
-   <c>Area</c>, <c>Resource</c>, and <c>Action</c> segments are mandatory for the creation of a valid <see cref="AccessPermission"/>. Missing segments will result in <see cref="AccessPermission.Errors.AreaRequired"/>, <see cref="AccessPermission.Errors.ResourceRequired"/>, or <see cref="AccessPermission.Errors.ActionRequired"/>.
-   <c>DisplayName</c> and <c>Description</c> are automatically generated by helper methods (<see cref="AccessPermission.GenerateDisplayName(string, string, string)"/>, <see cref="AccessPermission.GenerateDescription(string, string, string)"/>) if not explicitly provided during creation, ensuring a default human-readable representation.

---

## ü§ù Relationships & Dependencies

-   `AccessPermission` is a standalone entity. It is designed to be referenced by other entities or aggregates (e.g., `User` from `Identity.Users`, `Role` from `Identity.Roles`) for the purpose of assigning permissions. This implies a many-to-many relationship with `User` and `Role` aggregates, typically managed through junction entities or direct collections within those aggregates.
-   **Shared Kernel**: The `AccessPermission` entity inherits from `AuditableEntity` (from `SharedKernel.Domain.Entities`), providing common auditing fields. It also leverages `CommonInput.Constraints` and `CommonInput.Errors` (from `SharedKernel.Validations`) for consistent validation logic.

---

## üöÄ Key Use Cases / Behaviors

-   **Create Access Permission**: Instantiate a new <see cref="AccessPermission"/> using one of its factory methods:
    -   <see cref="AccessPermission.Create(string, string, string, string?, string?, string?, PermissionCategory)"/>: By specifying its <c>area</c>, <c>resource</c>, and <c>action</c> segments.
    -   <see cref="AccessPermission.Create(string, string?, string?, string?, PermissionCategory, string?)"/>: By providing a full permission name string (e.g., "admin.user.create"), which is then parsed internally.
-   **Update Access Permission Details**: Modify the <c>DisplayName</c>, <c>Description</c>, <c>Value</c>, or <c>PermissionCategory</c> of an existing <see cref="AccessPermission"/> using <see cref="AccessPermission.Update(string?, string?, string?, PermissionCategory?, string?)"/>. Note that the core <c>Name</c> (area.resource.action) is immutable after creation.
-   **Validate Permission Name Format**: Check if a given string conforms to the required <c>{area}.{resource}.{action}</c> permission naming convention using <see cref="AccessPermission.IsValidAccessPermissionName(string)"/>.
-   **Parse Permission Name**: Extract the <c>area</c>, <c>resource</c>, and <c>action</c> segments from a full <see cref="AccessPermission"/> name string using <see cref="AccessPermission.ParseAccessPermissionName(string)"/>.
-   **Generate Human-Readable Names**: Automatically create <c>DisplayName</c>s and <c>Description</c>s for permissions based on their segments using static helper methods <see cref="AccessPermission.GenerateDisplayName(string, string, string)"/> and <see cref="AccessPermission.GenerateDescription(string, string, string)"/>, facilitating user interface presentation.

---

## üìù Considerations / Notes

-   The immutability of the `AccessPermission.Name` after creation is a key design choice, ensuring that the fundamental identifier of a permission remains stable.
-   The structured naming convention (`area.resource.action`) is crucial for organizing permissions, making them discoverable, and enabling programmatic access control checks.
-   The `PermissionCategory` enum helps in designing user interfaces for permission management, allowing for filtering and grouping of permissions relevant to users or roles.
-   This domain focuses solely on the definition and management of permissions themselves, with the actual assignment and enforcement of these permissions being handled by other related identity domains (e.g., `Identity.Users`, `Identity.Roles`).